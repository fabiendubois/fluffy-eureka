<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculateur FTP cyclisme (W &amp; W/kg) ‚Äì Test 20‚Äô &amp; zones d‚Äôentra√Ænement</title>
  <meta name="description" content="Calcule ta FTP √† partir d‚Äôun test 20 minutes, d‚Äôun test ramp ou d‚Äôune estimation. Obtiens tes zones Z1‚ÄìZ7 et un plan d‚Äôentra√Ænement adapt√©.">
  <meta property="og:title" content="Calculateur FTP cyclisme gratuit (W &amp; W/kg)">
  <meta property="og:description" content="Simulateur FTP cycliste : tests 20 minutes, ramp, estimation par niveau. Zones d‚Äôentra√Ænement et plan 3 s√©ances inclus.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://example.com/ftp-cyclisme">
  <meta property="og:image" content="https://example.com/assets/ftp-cyclisme.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Calculateur FTP cyclisme (W &amp; W/kg)">
  <meta name="twitter:description" content="Calcule ta FTP, tes zones Z1-Z7 et ton plan d‚Äôentra√Ænement personnalis√©.">
  <meta name="twitter:image" content="https://example.com/assets/ftp-cyclisme.jpg">
  <style>
    :root {
      color-scheme: light;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.6;
      font-size: 16px;
      --accent: #1E88E5;
      --bg: #ffffff;
      --text: #12263A;
      --muted: #6b7a90;
      --shadow: 0 20px 40px rgba(18, 38, 58, 0.08);
      --radius: 18px;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px 16px 64px;
    }

    main {
      width: 100%;
      max-width: 640px;
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px 24px 40px;
    }

    header {
      text-align: center;
      margin-bottom: 24px;
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 2.4rem);
      margin: 0 0 8px;
      color: var(--accent);
    }

    header p {
      margin: 0;
      color: var(--muted);
      font-weight: 500;
    }

    p.lead {
      margin-top: 16px;
      color: var(--text);
    }

    form {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }

    fieldset {
      border: 2px solid rgba(30, 136, 229, 0.15);
      border-radius: var(--radius);
      padding: 16px;
      margin: 0;
    }

    legend {
      font-weight: 600;
      color: var(--accent);
      padding: 0 8px;
    }

    .mode-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }

    label {
      display: flex;
      flex-direction: column;
      font-weight: 600;
      color: var(--text);
      gap: 4px;
    }

    .radio-group label {
      flex-direction: row;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
    }

    .input-row {
      display: grid;
      gap: 12px;
    }

    input, select, button {
      border-radius: 12px;
      border: 1px solid rgba(18, 38, 58, 0.15);
      padding: 12px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, select:focus, button:focus {
      outline: 3px solid rgba(30, 136, 229, 0.3);
      outline-offset: 2px;
      border-color: var(--accent);
    }

    button[type="submit"] {
      background: var(--accent);
      color: #fff;
      border: none;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 12px 24px rgba(30, 136, 229, 0.25);
    }

    button[type="submit"]:hover {
      filter: brightness(1.05);
    }

    button[type="submit"]:active {
      transform: translateY(1px);
    }

    .method-panel {
      display: none;
      gap: 12px;
    }

    .method-panel.active {
      display: grid;
    }

    #results {
      border-radius: var(--radius);
      border: 1px solid rgba(30, 136, 229, 0.2);
      padding: 24px;
      background: linear-gradient(135deg, rgba(30, 136, 229, 0.12), rgba(30, 136, 229, 0.03));
      display: grid;
      gap: 16px;
    }

    #history {
      margin-top: 32px;
      border-radius: var(--radius);
      border: 1px solid rgba(30, 136, 229, 0.18);
      padding: 24px;
      background: #fff;
      box-shadow: 0 12px 30px rgba(18, 38, 58, 0.08);
      display: grid;
      gap: 12px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    #history h2 {
      margin: 0;
      color: var(--accent);
    }

    #history-empty {
      margin: 0;
      color: var(--muted);
    }

    #history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 8px;
    }

    #history-list li {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(18, 38, 58, 0.12);
      background: rgba(30, 136, 229, 0.08);
      font-weight: 500;
    }

    #history-clear {
      background: transparent;
      color: var(--accent);
      border: 1px solid rgba(30, 136, 229, 0.4);
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    #history-clear:hover:not(:disabled) {
      background: var(--accent);
      color: #fff;
    }

    #history-clear:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #results h2 {
      margin: 0;
      color: var(--accent);
      font-size: 1.5rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .stat-card {
      background: #fff;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 12px 30px rgba(18, 38, 58, 0.08);
      text-align: center;
    }

    .stat-card strong {
      display: block;
      font-size: 1.4rem;
      color: var(--accent);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(18, 38, 58, 0.08);
    }

    th, td {
      padding: 12px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: rgba(30, 136, 229, 0.1);
      color: var(--accent);
    }

    tbody tr:nth-child(odd) {
      background: rgba(30, 136, 229, 0.06);
    }

    tbody tr:nth-child(even) {
      background: #fff;
    }

    .zone-tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid var(--zone-color, var(--accent));
      background: rgba(30, 136, 229, 0.08);
      background: color-mix(in srgb, var(--zone-color, var(--accent)) 18%, transparent);
      color: var(--zone-color, var(--accent));
    }

    .zone-range {
      display: block;
      font-weight: 600;
    }

    .zone-duration {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .zone-bar {
      position: relative;
      height: 10px;
      border-radius: 999px;
      background: rgba(18, 38, 58, 0.12);
      margin-top: 8px;
      overflow: hidden;
    }

    .zone-bar__fill {
      display: block;
      height: 100%;
      border-radius: inherit;
      margin-left: var(--fill-start, 0);
      width: var(--fill-width, 100%);
      background: var(--zone-color, var(--accent));
    }

    .zone-bar--z1 { --zone-color: #9CCC65; }
    .zone-bar--z2 { --zone-color: #66BB6A; }
    .zone-bar--z3 { --zone-color: #FFCA28; }
    .zone-bar--z4 { --zone-color: #FFA726; }
    .zone-bar--z5 { --zone-color: #FB8C00; }
    .zone-bar--z6 { --zone-color: #F4511E; }
    .zone-bar--z7 { --zone-color: #E53935; }

    .plan {
      border-radius: 14px;
      background: #fff;
      box-shadow: 0 12px 30px rgba(18, 38, 58, 0.08);
      padding: 20px;
    }

    .plan h3 {
      margin-top: 0;
      color: var(--accent);
    }

    .plan ul {
      margin: 0;
      padding-left: 20px;
    }

    #motivation {
      font-weight: 700;
      color: var(--accent);
      text-align: center;
    }

    section {
      margin-top: 32px;
    }

    #affiliation ul {
      padding-left: 20px;
    }

    #affiliation a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    #affiliation a:hover {
      text-decoration: underline;
    }

    .faq-item {
      border-bottom: 1px solid rgba(18, 38, 58, 0.1);
      padding: 12px 0;
    }

    .faq-item:last-child {
      border-bottom: none;
    }

    footer {
      margin-top: 40px;
      font-size: 0.9rem;
      color: var(--muted);
      text-align: center;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 480px) {
      body {
        padding: 16px 12px 48px;
      }

      main {
        padding: 24px 18px 32px;
      }

      table, thead {
        font-size: 0.9rem;
      }
    }
  </style>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Comment calculer ma FTP ?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Tu peux r√©aliser un test de 20 minutes, un test ramp progressif ou utiliser une estimation selon ton niveau. Ce calculateur applique automatiquement le bon coefficient pour donner ta FTP en watts et en watts par kilo."
        }
      },
      {
        "@type": "Question",
        "name": "Quelle est la bonne FTP pour un cycliste amateur ?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "La FTP d\u2019un amateur varie souvent entre 2 et 4 W/kg. L\u2019objectif est d\u2019am\u00e9liorer progressivement ce chiffre avec des s\u00e9ances r\u00e9guli\u00e8res."
        }
      },
      {
        "@type": "Question",
        "name": "Quelle diff\u00e9rence entre FTP et W/kg ?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "La FTP repr\u00e9sente la puissance soutenable pendant une heure en watts. Les W/kg prennent aussi en compte ton poids : c\u2019est un bon indicateur pour comparer des cyclistes de morphologies diff\u00e9rentes."
        }
      },
      {
        "@type": "Question",
        "name": "Quand refaire un test FTP ?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Refais un test FTP toutes les 6 \u00e0 8 semaines pour suivre tes progr\u00e8s et ajuster tes zones d\u2019entra√Ænement."
        }
      }
    ]
  }
  </script>
</head>
<body>
  <main>
    <header>
      <h1>Calculateur FTP cyclisme gratuit (W &amp; W/kg)</h1>
      <p>Test 20‚Äô, test ramp, ou estimation simplifi√©e</p>
      <p class="lead">Renseigne ta puissance ou ton niveau. Le simulateur calcule ta FTP, tes zones d‚Äôentra√Ænement Coggan et te propose trois s√©ances par semaine pour progresser sans te blesser.</p>
    </header>

    <form id="ftp-form" aria-describedby="form-helper">
      <p id="form-helper">Choisis une m√©thode puis indique ta puissance ou ton poids. Tous les champs sont obligatoires pour obtenir un r√©sultat pr√©cis.</p>
      <fieldset>
        <legend>M√©thode de calcul</legend>
        <div class="mode-options radio-group">
          <label><input type="radio" name="mode" value="20min" checked> Test 20 minutes</label>
          <label><input type="radio" name="mode" value="ramp"> Test ramp</label>
          <label><input type="radio" name="mode" value="niveau"> Estimation par niveau</label>
        </div>
        <div class="method-panel active" data-panel="20min">
          <div class="input-row">
            <label for="power20">Puissance moyenne sur 20 min (W)
              <input id="power20" name="power20" type="number" min="50" max="700" inputmode="decimal" required>
            </label>
            <label for="weight20">Poids actuel (kg)
              <input id="weight20" name="weight20" type="number" min="30" max="150" inputmode="decimal" required>
            </label>
          </div>
        </div>
        <div class="method-panel" data-panel="ramp">
          <div class="input-row">
            <label for="powerramp">Puissance max tenue 1 min (W)
              <input id="powerramp" name="powerramp" type="number" min="50" max="800" inputmode="decimal">
            </label>
            <label for="weightramp">Poids actuel (kg)
              <input id="weightramp" name="weightramp" type="number" min="30" max="150" inputmode="decimal">
            </label>
          </div>
        </div>
        <div class="method-panel" data-panel="niveau">
          <div class="input-row">
            <label for="niveau">Ton niveau ressenti
              <select id="niveau" name="niveau">
                <option value="debutant">D√©butant</option>
                <option value="intermediaire">Interm√©diaire</option>
                <option value="avance">Avanc√©</option>
              </select>
            </label>
            <label for="weightniveau">Poids actuel (kg)
              <input id="weightniveau" name="weightniveau" type="number" min="30" max="150" inputmode="decimal">
            </label>
          </div>
        </div>
      </fieldset>
      <fieldset>
        <legend>Personnalisation du plan</legend>
        <div class="input-row">
          <label for="seances">Disponibilit√© hebdomadaire
            <select id="seances" name="seances">
              <option value="2">2 s√©ances</option>
              <option value="3" selected>3 s√©ances</option>
              <option value="4">4 s√©ances</option>
            </select>
          </label>
          <label for="objectif">Objectif principal
            <select id="objectif" name="objectif">
              <option value="endurance" selected>Endurance</option>
              <option value="intensite">Intensit√©</option>
              <option value="grimpe">Grimpe</option>
            </select>
          </label>
          <label for="duree">Temps par s√©ance
            <select id="duree" name="duree">
              <option value="45">45 min</option>
              <option value="60" selected>60 min</option>
              <option value="90">90 min</option>
            </select>
          </label>
        </div>
      </fieldset>
      <button type="submit">Calculer ma FTP</button>
    </form>

    <section id="results" aria-live="polite">
      <h2>R√©sultats personnalis√©s</h2>
      <div class="stats">
        <div class="stat-card" aria-label="FTP en watts">
          <span>FTP</span>
          <strong id="ftp-watts">0 W</strong>
        </div>
        <div class="stat-card" aria-label="FTP en watts par kilo">
          <span>W/kg</span>
          <strong id="ftp-wkg">0.00 W/kg</strong>
        </div>
      </div>
      <div>
        <h3>Zones d‚Äôentra√Ænement (table Coggan)</h3>
        <table aria-describedby="zone-helper">
          <caption id="zone-helper">Plages de puissance bas√©es sur ta FTP actuelle. La barre color√©e illustre la zone de travail, la colonne RPE d√©crit l‚Äôeffort per√ßu et la derni√®re colonne pr√©cise l‚Äôobjectif et la dur√©e conseill√©e.</caption>
          <thead>
            <tr>
              <th scope="col">Zone</th>
              <th scope="col">Plage de puissance</th>
              <th scope="col">RPE / sensations</th>
              <th scope="col">Objectif &amp; dur√©e</th>
            </tr>
          </thead>
          <tbody id="zone-table"></tbody>
        </table>
      </div>
      <div class="plan" aria-live="polite" aria-label="Plan d'entra√Ænement personnalis√©">
        <h3 id="plan-heading">Plan d‚Äôentra√Ænement personnalis√©</h3>
        <p id="plan-description">Renseigne ta disponibilit√© et ton objectif pour g√©n√©rer une semaine type.</p>
        <ul id="plan-list">
          <li>Choisis une m√©thode puis calcule ta FTP pour recevoir un plan cibl√©.</li>
        </ul>
      </div>
      <p id="motivation">Tu es pr√™t √† progresser üö¥‚Äç‚ôÇÔ∏è !</p>
    </section>

    <section id="history" aria-live="polite">
      <div class="history-header">
        <h2>Historique des calculs</h2>
        <button id="history-clear" type="button">Effacer l‚Äôhistorique</button>
      </div>
      <p id="history-empty">R√©alise un calcul pour remplir l‚Äôhistorique.</p>
      <ul id="history-list" aria-live="polite"></ul>
    </section>

    <section aria-labelledby="guide-tests">
      <h2 id="guide-tests">Comprendre tes tests FTP</h2>
      <p>Le test de 20 minutes est rapide et fiable. Tu p√©dales √† fond pendant vingt minutes puis le calculateur retire 5&nbsp;% pour estimer ton effort sur une heure. Le test ramp augmente la puissance chaque minute jusqu‚Äô√† l‚Äô√©chec : nous retenons 75&nbsp;% de la derni√®re minute compl√®te.</p>
      <p>Pas encore √©quip√© ? Choisis l‚Äôestimation par niveau. C‚Äôest pratique pour planifier tes s√©ances ou pour suivre une progression simple sans stress.</p>
    </section>

    <section aria-labelledby="conseils">
      <h2 id="conseils">Conseils pour progresser en s√©curit√©</h2>
      <ul>
        <li>√âchauffe-toi au moins 15 minutes avant chaque test pour prot√©ger tes muscles.</li>
        <li>Hydrate-toi r√©guli√®rement, m√™me en int√©rieur sur home-trainer.</li>
        <li>Dors suffisamment : la r√©cup√©ration est la cl√© pour augmenter ta FTP.</li>
        <li>Ajoute une sortie facile en Z1-Z2 pour consolider ton endurance de base.</li>
      </ul>
    </section>

    <!-- AFFILIATE_BLOCK -->
    <section id="affiliation" aria-labelledby="affiliation-title">
      <h2 id="affiliation-title">Capteurs &amp; home-trainers recommand√©s</h2>
      <ul>
        <li>Capteur de puissance ‚Äì <a href="#">Voir le prix</a></li>
        <li>Home-trainer connect√© ‚Äì <a href="#">Voir le prix</a></li>
        <li>Montre GPS v√©lo ‚Äì <a href="#">Voir le prix</a></li>
      </ul>
      <p><em>Liens affili√©s : je peux percevoir une petite commission, sans surco√ªt pour toi.</em></p>
    </section>
    <!-- END AFFILIATE_BLOCK -->

    <section aria-labelledby="faq-title">
      <h2 id="faq-title">FAQ FTP cyclisme</h2>
      <div class="faq-item">
        <h3>Comment calculer ma FTP ?</h3>
        <p>R√©alise un test 20 minutes √† fond, un test ramp ou utilise l‚Äôestimation par niveau. Ensuite, clique sur ¬´ Calculer ma FTP ¬ª pour obtenir ton r√©sultat.</p>
      </div>
      <div class="faq-item">
        <h3>Quelle est la bonne FTP pour un cycliste amateur ?</h3>
        <p>Un cycliste amateur se situe souvent entre 2 et 4&nbsp;W/kg. Avec un suivi r√©gulier, tu peux viser une progression de 5&nbsp;% tous les deux mois.</p>
      </div>
      <div class="faq-item">
        <h3>Quelle diff√©rence entre FTP et W/kg ?</h3>
        <p>La FTP exprime ta puissance pure en watts. Les watts par kilo comparent ta puissance √† ton poids et donnent une vision plus juste de tes performances en c√¥te.</p>
      </div>
      <div class="faq-item">
        <h3>Quand refaire un test FTP ?</h3>
        <p>Teste-toi toutes les 6 √† 8 semaines, ou apr√®s un bloc d‚Äôentra√Ænement structur√©, pour valider les progr√®s et adapter les intensit√©s.</p>
      </div>
    </section>

    <footer>
      <p>Mentions l√©gales ‚Äì Texte indicatif</p>
      <p><a href="#">Politique de confidentialit√©</a></p>
      <p>Disclaimer : Cet outil est informatif. Consulte ton entra√Æneur avant tout changement de programme.</p>
    </footer>
  </main>

  <script>
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const panels = document.querySelectorAll('.method-panel');
    const ftpForm = document.getElementById('ftp-form');
    const ftpWatts = document.getElementById('ftp-watts');
    const ftpWkg = document.getElementById('ftp-wkg');
    const zoneTable = document.getElementById('zone-table');
    const planHeading = document.getElementById('plan-heading');
    const planDescription = document.getElementById('plan-description');
    const planList = document.getElementById('plan-list');
    const motivation = document.getElementById('motivation');
    const historyList = document.getElementById('history-list');
    const historyEmpty = document.getElementById('history-empty');
    const historyClearBtn = document.getElementById('history-clear');

    const workouts = {
      debutant: {
        endurance: [
          '45 min en Z2 avec 5 acc√©l√©rations de 30 s en Z3, r√©cup√©ration 2 min en Z1.',
          'Sortie longue 60 √† 75 min en Z2, cadence souple et respiration contr√¥l√©e.',
          '3 √ó 8 min en Z3 avec 4 min faciles entre les blocs.',
          'Sortie libre de 60 min en Z1-Z2 pour travailler la v√©locit√©.'
        ],
        intensite: [
          '√âchauffement 15 min puis 4 √ó 3 min en Z4, r√©cup√©ration 3 min en Z1.',
          'Pyramide 1-2-3-2-1 min en Z5 avec r√©cup√©rations √©gales au temps d‚Äôeffort.',
          '30 min en Z2 puis 6 sprints de 20 s en Z6, r√©cup√©ration 2 min souple.',
          'Sortie ais√©e 50 min en Z2 pour assimiler la charge.'
        ],
        grimpe: [
          '4 √ó 5 min en c√¥te √† 60 rpm en Z3, r√©cup√©ration en descente tranquille.',
          'Sortie vallonn√©e 75 min en Z2-Z3 en restant assis dans les bosses.',
          '8 √ó 2 min en Z4 sur pente mod√©r√©e, r√©cup√©ration 3 min faciles.',
          'Grimpe technique : 45 min avec 6 √ó 1 min en force √† 55 rpm.'
        ]
      },
      intermediaire: {
        endurance: [
          '60 min en Z2 avec 2 √ó 10 min en Z3 au milieu de la s√©ance.',
          'Sortie longue 90 min en Z2, terminer par 10 min en Z3.',
          '4 √ó 12 min tempo en Z3, r√©cup√©ration 4 min en Z1.',
          'Sortie r√©cup√©ration 60 min en Z1-Z2 ax√©e v√©locit√©.'
        ],
        intensite: [
          '√âchauffement complet puis 5 √ó 4 min en Z5, r√©cup√©ration 3 min.',
          '3 √ó 10 min au seuil en Z4, r√©cup√©ration 5 min souple.',
          '8 √ó 30 s en Z6-Z7 avec 4 min faciles entre les sprints.',
          'Endurance active 75 min en Z2 avec 4 √ó 1 min de cadence tr√®s √©lev√©e.'
        ],
        grimpe: [
          '6 √ó 5 min en Z4 sur pente r√©guli√®re, r√©cup√©ration 4 min en Z2.',
          'Sortie montagne 2 h en Z2 avec 3 bosses de 10 min en Z3.',
          '10 √ó 1 min √† 60 rpm en Z5 pour d√©velopper la force, r√©cup√©ration 2 min.',
          '45 min alternant 2 min assis / 2 min en danseuse en Z3.'
        ]
      },
      avance: {
        endurance: [
          '2 √ó 20 min tempo entre Z3 et Z4, r√©cup√©ration 10 min en Z2.',
          'Sortie endurance de 2 h avec 3 √ó 15 min en Z3 r√©parties sur la sortie.',
          'Bloc 90 min en Z2 suivi de 10 min en Z4 pour finir.',
          'Sortie r√©cup√©ration 75 min en Z1-Z2 avec exercices de cadence.'
        ],
        intensite: [
          '4 √ó 8 min en Z5, r√©cup√©ration 4 min contr√¥l√©e.',
          '2 √ó 15 min au seuil haut (Z4-Z5), r√©cup√©ration 8 min en Z2.',
          '3 blocs de 5 √ó 1 min en Z6 avec 1 min de r√©cup√©ration, 8 min entre blocs.',
          'Endurance soutenue 90 min en Z2 ponctu√©e de 6 √ó 10 s en Z7.'
        ],
        grimpe: [
          '3 √ó 12 min en Z4 sur pente √† 6 %, r√©cup√©ration 6 min.',
          'Sortie grimpe 1 h 45 avec 2 ascensions de 20 min en Z3.',
          '8 √ó 3 min en Z5 √† 55 rpm pour la force, r√©cup√©ration en descente.',
          'Sortie technique 75 min avec relances hors des virages en Z4.'
        ]
      }
    };

    const levelLabels = {
      debutant: 'D√©butant',
      intermediaire: 'Interm√©diaire',
      avance: 'Avanc√©'
    };

    const objectiveLabels = {
      endurance: 'Endurance',
      intensite: 'Intensit√©',
      grimpe: 'Grimpe'
    };

    const zoneDefs = [
      {
        label: 'Z1',
        name: 'Endurance active',
        min: 0,
        max: 0.55,
        description: 'R√©cup√©ration facile',
        rpe: 'RPE 1-2/10 ‚Äì Tr√®s facile, conversation ais√©e',
        couleur: '#9CCC65',
        dureeConseillee: '45 √† 120 min et plus'
      },
      {
        label: 'Z2',
        name: 'Endurance',
        min: 0.56,
        max: 0.75,
        description: 'Sorties longues',
        rpe: 'RPE 2-3/10 ‚Äì Stable, respiration contr√¥l√©e',
        couleur: '#66BB6A',
        dureeConseillee: '60 √† 180 min'
      },
      {
        label: 'Z3',
        name: 'Tempo',
        min: 0.76,
        max: 0.90,
        description: 'Souffle r√©gulier',
        rpe: 'RPE 3-4/10 ‚Äì Soutenu mais confortable',
        couleur: '#FFCA28',
        dureeConseillee: '20 √† 60 min'
      },
      {
        label: 'Z4',
        name: 'Seuil',
        min: 0.91,
        max: 1.05,
        description: 'Allure chrono',
        rpe: 'RPE 5-6/10 ‚Äì Dur mais contr√¥l√©',
        couleur: '#FFA726',
        dureeConseillee: '10 √† 30 min par blocs'
      },
      {
        label: 'Z5',
        name: 'VO2max',
        min: 1.06,
        max: 1.20,
        description: 'Efforts intenses',
        rpe: 'RPE 7-8/10 ‚Äì Respiration haletante',
        couleur: '#FB8C00',
        dureeConseillee: '3 √† 8 min par r√©p√©tition'
      },
      {
        label: 'Z6',
        name: 'Ana√©robie',
        min: 1.21,
        max: 1.50,
        description: 'Sprints courts',
        rpe: 'RPE 9/10 ‚Äì Explosion maximale',
        couleur: '#F4511E',
        dureeConseillee: '30 s √† 3 min par r√©p√©tition'
      },
      {
        label: 'Z7',
        name: 'Neuromusculaire',
        min: 1.51,
        max: Infinity,
        description: 'D√©marrages explosifs',
        rpe: 'RPE 10/10 ‚Äì Effort total',
        couleur: '#E53935',
        dureeConseillee: 'Jusqu‚Äô√† 30 s'
      }
    ];

    modeRadios.forEach(radio => {
      radio.addEventListener('change', () => {
        panels.forEach(panel => {
          const isActive = panel.dataset.panel === radio.value;
          panel.classList.toggle('active', isActive);
          const inputs = panel.querySelectorAll('input');
          inputs.forEach(input => input.required = isActive);
          const selects = panel.querySelectorAll('select');
          selects.forEach(select => select.required = isActive);
        });
      });
    });

    function formatRange(min, max) {
      if (max === Infinity) {
        return `>${Math.round(min)} W`;
      }
      return `${Math.round(min)} ‚Äì ${Math.round(max)} W`;
    }

    function determineLevel(mode, ftp, weight) {
      const levelSelect = document.getElementById('niveau');
      const objectiveSelect = document.getElementById('objectif');
      const sessionsSelect = document.getElementById('seances');
      const durationSelect = document.getElementById('duree');

      let level = levelSelect ? levelSelect.value : 'debutant';

      if (mode !== 'niveau') {
        const ratio = ftp && weight ? ftp / weight : 0;
        if (ratio < 2.6) level = 'debutant';
        else if (ratio < 3.5) level = 'intermediaire';
        else level = 'avance';
      }

      const sessionsValue = parseInt(sessionsSelect?.value || '3', 10);
      const durationValue = parseInt(durationSelect?.value || '60', 10);

      return {
        level,
        objective: objectiveSelect?.value || 'endurance',
        sessions: Number.isFinite(sessionsValue) && sessionsValue > 0 ? sessionsValue : 3,
        duration: Number.isFinite(durationValue) && durationValue > 0 ? durationValue : 60
      };
    }

    function renderPlan(planConfig) {
      const { level, objective, sessions, duration } = planConfig;
      const levelPlans = workouts[level] || workouts.debutant;
      const objectivePlans = levelPlans?.[objective] || levelPlans?.endurance || [];
      const totalSessions = Number.isFinite(sessions) && sessions > 0 ? sessions : 3;
      const sessionDuration = Number.isFinite(duration) && duration > 0 ? duration : 60;
      const planItems = Array.isArray(objectivePlans) ? [...objectivePlans] : [];
      const fallbackText = `Sortie libre : ${sessionDuration} min en Z2 pour consolider l‚Äôendurance.`;

      while (planItems.length < totalSessions) {
        planItems.push(fallbackText);
      }

      const finalPlan = planItems.slice(0, totalSessions);

      planList.innerHTML = '';
      finalPlan.forEach((text, index) => {
        const li = document.createElement('li');
        li.textContent = `S√©ance ${index + 1} : ${text}`;
        planList.appendChild(li);
      });

      const levelLabel = levelLabels[level] || levelLabels.debutant;
      const objectiveLabel = objectiveLabels[objective] || objectiveLabels.endurance;
      const sessionWord = totalSessions > 1 ? 's√©ances' : 's√©ance';
      planHeading.textContent = `${levelLabel} ¬∑ ${objectiveLabel} ¬∑ ${totalSessions} ${sessionWord}/semaine`;
      planDescription.textContent = `Dur√©e cible : ~${sessionDuration} min par s√©ance. Ajuste l‚Äô√©chauffement et le retour au calme selon ta fatigue.`;
    }

    function updateZones(ftp) {
      zoneTable.innerHTML = '';
      const intensityMax = 1.6;
      zoneDefs.forEach(zone => {
        const tr = document.createElement('tr');
        const minWatts = zone.min === 0 ? 0 : ftp * zone.min;
        const maxWatts = zone.max === Infinity ? Infinity : ftp * zone.max;
        const cappedMin = Math.min(zone.min, intensityMax);
        const cappedMax = zone.max === Infinity ? intensityMax : Math.min(zone.max, intensityMax);
        const fillStart = Math.min((cappedMin / intensityMax) * 100, 100);
        const rawWidth = ((cappedMax - cappedMin) / intensityMax) * 100;
        const minVisibleWidth = cappedMax > cappedMin ? Math.max(rawWidth, 6) : 6;
        const availableWidth = 100 - fillStart;
        const fillWidth = Math.max(Math.min(minVisibleWidth, availableWidth), 0);
        const zoneClass = `zone-bar zone-bar--${zone.label.toLowerCase()}`;
        const fillStyles = `--fill-start:${fillStart}%;--fill-width:${fillWidth}%;--zone-color:${zone.couleur};`;
        tr.innerHTML = `
          <td><span class="zone-tag" style="--zone-color:${zone.couleur};">${zone.label}</span> ${zone.name}</td>
          <td>
            <span class="zone-range">${formatRange(minWatts, maxWatts)}</span>
            <div class="${zoneClass}" aria-hidden="true">
              <span class="zone-bar__fill" style="${fillStyles}"></span>
            </div>
          </td>
          <td>${zone.rpe}</td>
          <td>
            <strong>${zone.description}</strong><br>
            <span class="zone-duration">${zone.dureeConseillee}</span>
          </td>`;
        zoneTable.appendChild(tr);
      });
    }

    updateZones(0);
    function readHistory() {
      try {
        const stored = localStorage.getItem('ftp-history');
        if (!stored) return [];
        const parsed = JSON.parse(stored);
        return Array.isArray(parsed) ? parsed : [];
      } catch (error) {
        console.error('Impossible de lire l\'historique FTP :', error);
        return [];
      }
    }

    function formatHistoryDate(value) {
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) {
        return value;
      }
      return date.toLocaleString('fr-FR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function renderHistory() {
      const history = readHistory();
      historyList.innerHTML = '';

      if (!history.length) {
        historyEmpty.hidden = false;
        historyList.hidden = true;
        historyClearBtn.disabled = true;
        return;
      }

      historyEmpty.hidden = true;
      historyList.hidden = false;
      historyClearBtn.disabled = false;

      history.forEach(entry => {
        const li = document.createElement('li');
        const modeLabel = {
          '20min': 'Test 20 minutes',
          ramp: 'Test ramp',
          niveau: 'Estimation par niveau'
        }[entry.mode] || entry.mode;
        li.textContent = `${formatHistoryDate(entry.date)} ‚Äì ${modeLabel} : ${entry.ftp} W (${entry.wkg} W/kg)`;
        historyList.appendChild(li);
      });
    }

    ftpForm.addEventListener('submit', event => {
      event.preventDefault();
      const mode = [...modeRadios].find(r => r.checked)?.value;
      let ftp = 0;
      let weight = 0;

      if (mode === '20min') {
        const power20 = parseFloat(document.getElementById('power20').value);
        weight = parseFloat(document.getElementById('weight20').value);
        if (!power20 || !weight) {
          alert('Merci de renseigner une puissance et un poids valides.');
          return;
        }
        ftp = power20 * 0.95;
      } else if (mode === 'ramp') {
        const powerRamp = parseFloat(document.getElementById('powerramp').value);
        weight = parseFloat(document.getElementById('weightramp').value);
        if (!powerRamp || !weight) {
          alert('Merci de renseigner une puissance et un poids valides.');
          return;
        }
        ftp = powerRamp * 0.75;
      } else if (mode === 'niveau') {
        const level = document.getElementById('niveau').value;
        weight = parseFloat(document.getElementById('weightniveau').value);
        if (!weight) {
          alert('Merci de renseigner ton poids pour l‚Äôestimation.');
          return;
        }
        if (level === 'debutant') ftp = weight * 2.3;
        if (level === 'intermediaire') ftp = weight * 3.1;
        if (level === 'avance') ftp = weight * 3.8;
      }

      const wkg = weight ? ftp / weight : 0;
      ftpWatts.textContent = `${Math.round(ftp)} W`;
      ftpWkg.textContent = `${wkg.toFixed(2)} W/kg`;

      updateZones(ftp);
      const planConfig = determineLevel(mode, ftp, weight);
      renderPlan(planConfig);

      motivation.textContent = 'Tu es pr√™t √† progresser üö¥‚Äç‚ôÇÔ∏è ! Continue sur cette lanc√©e !';

      const history = readHistory();
      const entry = {
        date: new Date().toISOString(),
        mode,
        ftp: Math.round(ftp),
        wkg: parseFloat(wkg.toFixed(2))
      };
      history.unshift(entry);
      localStorage.setItem('ftp-history', JSON.stringify(history));
      renderHistory();
    });

    historyClearBtn.addEventListener('click', () => {
      localStorage.removeItem('ftp-history');
      renderHistory();
    });

    renderHistory();
  </script>
</body>
</html>
